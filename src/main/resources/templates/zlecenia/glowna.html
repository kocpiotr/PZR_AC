<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Pan Złota Rączka - Admin Console</title>
    <!-- Bootstrap core CSS-->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template-->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- Custom styles for this template-->
    <link href="css/sb-admin.css" rel="stylesheet">
    <!-- Font awesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
</head>

<body class="fixed-nav sticky-footer bg-dark" id="page-top">
<!-- Navigation-->
<div th:replace="fragments/navigation :: navigation-panel-left">Static navigation!!!</div>

<div class="content-wrapper">
    <div class="container-fluid">
        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="index.html">Strona Główna</a>
            </li>
            <li class="breadcrumb-item active">Zlecenia</li>
        </ol>
        <div class="row py-2 float-none">
            <div class="col-3">
                <a class="dodajZlecenie btn btn-primary" data-toggle="modal" data-target="#dodajZlecenieModal">Dodaj Zlecenie</a>
            </div>
        </div>

        <!--USUWANIE/ARCHIWIZOWANIE-->
        <!--EDYCJA-->

        <!-- ZLECENIA-->
        <div class="datatable-wide">
            <div class="card mb-3">
                <div class="card-header">
                    <i class="fa fa-table"></i> Zlecenia
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover table-sm table-striped" id="dataTable" width="80%" cellspacing="10">
                            <thead>
                            <tr>
                                <th>Status</th>
                                <th>Data Zgłoszenia</th>
                                <th>Data Realizacji</th>
                                <th>Pora Dnia Realizacji</th>
                                <th>Specialista</th>
                                <th>Miasto</th>
                                <th>Dzielnica</th>
                                <th>Opis</th>
                                <th>Nr telefonu</th>
                                <th>edytuj</th>
                                <th>usun</th>
                                <th>Przetwarzaj</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="orderr : ${existingOrderrs}">
                                <td>
                                    <i class="fas " th:classappend="${orderr.process.currentStep.name == 'Nowe'} ? 'fa-exclamation-triangle text-danger' : 'fa-check-circle text-success'"></i>
                                    <p th:text="${orderr.process.currentStep.name}"></p>
                                </td>
                                <td th:text="${#temporals.format(orderr.creationDate, 'dd-MM-yyyy HH:mm')}">2011/04/25</td>
                                <td th:text="${#temporals.format(orderr.serviceDate, 'dd-MM-yyyy')}">2011/04/25</td>
                                <td th:text="${orderr.serviceTimeOfDay}">Hydraulik</td>
                                <td th:text="${orderr.specjalista.name}">Hydraulik</td>
                                <td th:text="${orderr.address.city.name}">Elbląg</td>
                                <td th:text="${orderr.address.district.name}">Zawada</td>
                                <td th:text="${orderr.description}">Wymiana spłuczki</td>
                                <td th:text="${orderr.phoneNumber}">515079676</td>
                                <td>
                                	<span class="edytujZlecenie fa fa-pencil-alt" th:attr="zlecenie-id=${orderr.id}, specjalista_id=${orderr.specjalista.id}, terminDateTime=${orderr.serviceDate}, teminTimeOfDay=${orderr.serviceTimeOfDay},
                                	miasto_id=${orderr.address.city.id}, opis=${orderr.description}, dzielnica_id=${orderr.address.district.id}, nr-telefonu=${orderr.phoneNumber}"
                                	data-toggle="modal" data-target="#dodajZlecenieModal"></span>
                                </td>
                                <td>
                                	<span class="usunZlecenie fa fa-trash" th:attr="zlecenie-id=${orderr.id}"
                                	data-toggle="modal" data-target="#usunZlecenieModal"></span>
                                </td>
                                <td>
                                	<span class="fas fa-play-circle" data-toggle="modal" th:attr="zlecenie-id=${orderr.id}" data-target="#przetwarzajZlecenieModal"></span>
                                </td>
                            </tr>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
            </div>
        </div>

    </div>

    <div th:replace="fragments/common :: footer">static logout modal</div>

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fa fa-angle-up"></i>
    </a>

    <div th:replace="fragments/common :: logout">static logout modal</div>
    <!--<div th:replace="fragments/common :: dodajZlecenie">static dodaj zlecenie modal</div>-->


    <div class="modal fade" id="dodajZlecenieModal" tabindex="-1" role="dialog" aria-labelledby="DodajZlecenieModalLabel" aria-hidden="true" th:fragment="dodajZlecenie">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="belka_tytulowa_dodaj_edytuj_zlecenie modal-title" id="dodajZlecenieModalLabel">Dodaj Zlecenie</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">

                    <form name="sentMessage" method="post" id="dodajZLecenieFormId" novalidate="novalidate" action="/zlecenia/dodaj" th:object="${pusteZlecenie}">
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="specialistDropdownId">Specjalista:</label>
                                <select class="form-control" id="specialistDropdownId" name="specialistDropdownName" autofocus th:field="*{specjalista}"
                                        data-validation="required" data-validation-error-msg="Proszę powiedz nam jakiego specjalisty szukasz.">
                                    <option th:each="specialist : ${availableSpecializations}"
                                            th:value="${specialist.id}"
                                            th:text="${specialist.name}"></option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="terminDateTimeId">Termin</label>
                                <input class="form-control" id="terminDateTimeId" type="date"
                                       placeholder="W jakim terminie" th:field="*{serviceDate}" data-validation="required"
                                       data-validation-error-msg="W jaki terminie ma być wykonana usługa.">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="terminTimeInDayeId">Pora Dnia</label>
                                <select class="form-control" id="terminTimeInDayeId" name="poraDniaDropdownName" th:field="*{serviceTimeOfDay}"
                                        data-validation="required" data-validation-error-msg="O jakiej porze dnia ma być wykonana usługa.">
                                    <option th:each="poraDnia : ${timesOfDay}"
                                            th:value="${poraDnia.name()}"
                                            th:text="${poraDnia.name()}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="miastoDropdownId">Miasto:</label>
                                <select class="form-control" id="miastoDropdownId" name="miastoDropdownName"
                                        th:field="*{address.city}" data-validation="required"
                                        data-validation-error-msg="Proszę powiedz nam w jakim mieśćie ma być świadczona usługa.">
                                    <option th:each="city : ${availableCities}"
                                            th:value="${city.id}"
                                            th:text="${city.name}">other</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="opisTextAreaId">Opis</label>
                                <textarea class="form-control" id="opisTextAreaId" rows="3" name="opisTextAreaName" th:field="*{description}"
                                          placeholder="Chcę aby....Opisz jaką pracę chcesz zlecić." required="required" data-validation="required"
                                          data-validation-error-msg="Proszę, opisz w kilku słowach co jest do zrobienia."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="districtDropdownId">Dzielnica:</label>
                                <select class="form-control" id="districtDropdownId" name="districtDropdownName" 
                                		th:field="*{address.district}" data-validation="required"
                                		data-validation-error-msg="Proszę powiedz nam w jakiej dzielnicy ma być świadczona usługa.">
                                    <option th:each="district : ${availableDistricts}"
                                            th:value="${district.id}"
                                            th:text="${district.name}">ble</option>
                                </select>
                            </div>
                            <div class="form-group col-md-6">
                                <label for="nrTelefonuTextId">Numer Telefonu</label>
                                <input class="form-control" id="nrTelefonuTextId" type="tel" placeholder="Numer telefonu"
                                       th:field="*{phoneNumber}" data-validation="required"
                                       data-validation-error-msg="Proszę podaj numer na który mamy oddzwonić (gdy znajdziemy kogoś odpowwiedniego)">
                            </div>
                        </div>
                        <br>
                        <div id="success"></div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-xl" id="sendMessageButton">Wyślij</button>
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Anuluj</button>
                </div>
            </div>
        </div>
    </div>

		<div class="modal fade" id="usunZlecenieModal" tabindex="-1"
			role="dialog" aria-labelledby="UsunZlecenieModalLabel"
			aria-hidden="true" th:fragment="usunZlecenie">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="usunZlecenieModalLabel">Usun Zlecenie</h5>
						<button class="close" type="button" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">×</span>
						</button>
					</div>
					<div class="modal-body">
						<form name="usunZlecenieForm" method="post" id="usunZlecenieFormId"
							novalidate="novalidate" action="/usunZlecenie" th:object="${pusteZlecenie}">
							<input type="hidden" id="hidden_zlecenie_id_value" value = '6'/>
							<div class="form-row">
								<div class="form-group col-md-6">
									<label>Czy napewno chcesz usunąć zlecenie?</label>
								</div>
							</div>
							<br>
							<div class="modal-footer">
								<button class="btn btn-secondary" id="usunZlecenieButtonYes" type="button"
									data-dismiss="modal">Tak</button>
								<button class="btn btn-secondary" type="button"
									data-dismiss="modal">Nie</button>
							</div>
						</form>
					</div>

				</div>
			</div>
		</div>

		<!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.3.26/jquery.form-validator.min.js"></script>

    <script>

        $("#miastoDropdownId").change(function () {
            var selectedCity = $("#miastoDropdownId :selected").text();

            //remove all districts
            $("#districtDropdownId").empty();

            //populate new districts
            $.getJSON("/districts/" + selectedCity, function (json) {
                $.each(json, function (idx, field) {
                    $("select#districtDropdownId").append($("<option></option>")
                        .attr("value", field.id)
                        .text(field.name));
                });
            });

        });
        
        $(".usunZlecenie").click(function () {
        	var komponent = $(this);
            var zlecenie_id = komponent.attr('zlecenie-id');
            $("input#hidden_zlecenie_id_value").val(zlecenie_id);
            $("button#usunZlecenieButtonYes").attr("onclick", "location.href='/zlecenia/usun/" + zlecenie_id + "'");
        })

        $(".dodajZlecenie").click(function () {
        	$("h5#dodajZlecenieModalLabel").text("Dodaj Zlecenie");
        	$("#dodajZLecenieFormId").attr("action","/zlecenia/dodaj");
        	
            $("select#specialistDropdownId").val("");
            $("input#terminDateTimeId").val("");
            $("select#terminTimeInDayeId").val("");
            $("select#miastoDropdownId").val("");
            $("textarea#opisTextAreaId").val("");
            $("select#districtDropdownId").val("");
            $("input#nrTelefonuTextId").val("");
            
        })
        
        $(".edytujZlecenie").click(function () {
        	var komponent = $(this);
            
        	var zlecenie_id = komponent.attr('zlecenie-id');
        	var specjalista_id = komponent.attr('specjalista_id');
        	var terminDateTime = komponent.attr('terminDateTime');
        	var teminTimeOfDay = komponent.attr('teminTimeOfDay');
        	var miasto_id = komponent.attr('miasto_id');
        	var opis = komponent.attr('opis');
        	var dzielnica_id = komponent.attr('dzielnica_id');
        	var nr_telefonu = komponent.attr('nr-telefonu');
        	
            $("h5#dodajZlecenieModalLabel").text("Edytuj Zlecenie");
            $("#dodajZLecenieFormId").attr("action","/zlecenia/edytuj/"+zlecenie_id);
        	
            $("select#specialistDropdownId").val(specjalista_id);
            $("input#terminDateTimeId").val(terminDateTime);
            $("select#terminTimeInDayeId").val(teminTimeOfDay);
            $("select#miastoDropdownId").val(miasto_id).change();
            $("textarea#opisTextAreaId").val(opis);
            $("select#districtDropdownId").val(dzielnica_id);
            $("input#nrTelefonuTextId").val(nr_telefonu);  
        })
        
        
        var myLanguage = {
            errorTitle: 'Błąd w formularzu',
            requiredFields: 'You have not answered all required fields',
            badTime: 'You have not given a correct time',
            badEmail: 'You have not given a correct e-mail address',
            badTelephone: 'You have not given a correct phone number',
            badSecurityAnswer: 'You have not given a correct answer to the security question',
            badDate: 'You have not given a correct date',
            lengthBadStart: 'The input value must be between ',
            lengthBadEnd: ' characters',
            lengthTooLongStart: 'The input value is longer than ',
            lengthTooShortStart: 'The input value is shorter than ',
            notConfirmed: 'Input values could not be confirmed',
            badDomain: 'Incorrect domain value',
            badUrl: 'The input value is not a correct URL',
            badCustomVal: 'The input value is incorrect',
            andSpaces: ' and spaces ',
            badInt: 'The input value was not a correct number',
            badSecurityNumber: 'Your social security number was incorrect',
            badUKVatAnswer: 'Incorrect UK VAT Number',
            badStrength: 'The password isn\'t strong enough',
            badNumberOfSelectedOptionsStart: 'You have to choose at least ',
            badNumberOfSelectedOptionsEnd: ' answers',
            badAlphaNumeric: 'The input value can only contain alphanumeric characters ',
            badAlphaNumericExtra: ' and ',
            wrongFileSize: 'The file you are trying to upload is too large (max %s)',
            wrongFileType: 'Only files of type %s is allowed',
            groupCheckedRangeStart: 'Please choose between ',
            groupCheckedTooFewStart: 'Please choose at least ',
            groupCheckedTooManyStart: 'Please choose a maximum of ',
            groupCheckedEnd: ' item(s)',
            badCreditCard: 'The credit card number is not correct',
            badCVV: 'The CVV number was not correct',
            wrongFileDim: 'Incorrect image dimensions,',
            imageTooTall: 'the image can not be taller than',
            imageTooWide: 'the image can not be wider than',
            imageTooSmall: 'the image was too small',
            min: 'min',
            max: 'max',
            imageRatioNotAccepted: 'Image ratio is not accepted'
        };


        $.validate({
            validateOnBlur: false, // disable validation when input looses focus
            errorMessagePosition: 'top', // Instead of 'inline' which is default
            language: myLanguage
        });
	</script>


</div>
</body>
</html>